<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>World Timezones & Calendar (2024â€“2027)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!--
  World Timezones & Calendar
  - Features:
    * Dark mode (toggle)
    * Compact view (toggle)
    * Flag emojis in timezone cards
    * Years 2024â€“2027 selector
    * 24h / AM-PM toggle (persists in localStorage)
    * Timezones sorted from most advanced (latest local time) â†’ earliest
    * Comments throughout for maintainability
-->

<style>
  :root{
    /* Light theme variables */
    --border: #d0d7de;
    --bg: #ffffff;
    --bg-muted: #f7f8fa;
    --weekend: #e6e8eb;
    --text: #111827;
    --muted: #6b7280;
    --accent: #2563eb;
    --highlight: #cfe8ff;
    --quarter-highlight: #fff3cd;
    --card-shadow: rgba(16,24,40,0.03);
    --flag-font-size: 18px;
  }

  /* Dark theme overrides (applied by .dark on <html>) */
  html.dark {
    --border: #2a2f36;
    --bg: #0b0f14;
    --bg-muted: #071018;
    --weekend: #0f1720;
    --text: #e6eef6;
    --muted: #98a3b3;
    --accent: #3b82f6;
    --highlight: #08304b;
    --quarter-highlight: #3b2e00;
    --card-shadow: rgba(0,0,0,0.6);
  }

  /* Compact mode is toggled by adding .compact on <body> */
  body.compact {
    margin: 10px;
    font-size: 13px;
  }
  body {
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    margin: 24px;
    color: var(--text);
    background: var(--bg);
  }

  /* Headings */
  h1 { margin: 0 0 12px; font-size: 22px; }
  h2 { margin: 18px 0 12px; font-size: 18px; }

  /* Card common */
  .card {
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    background: var(--bg);
    box-shadow: 0 1px 2px var(--card-shadow);
  }

  /* Top controls bar */
  .controls {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 12px;
  }
  .controls .group { display:flex; gap:8px; align-items:center; }

  /* Small icon/button style */
  .btn {
    padding: 6px 10px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--bg-muted);
    cursor: pointer;
    font-size: 13px;
  }
  .btn.active { background: var(--accent); color: #fff; border-color: transparent; font-weight:600; }

  /* Timezone grid */
  .tz-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 12px;
  }
  .tz-item {
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px;
    background: var(--bg-muted);
    text-align: center;
    min-height: 86px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    gap:6px;
  }
  body.compact .tz-item { padding:8px; min-height:64px; }

  .tz-top {
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
  }
  .tz-flag { font-size: var(--flag-font-size); line-height:1; }
  body.compact .tz-flag { font-size: 16px; }

  .tz-name {
    font-weight: 600;
    font-size: 15px;
  }
  body.compact .tz-name { font-size: 13px; }

  .tz-time {
    font-size: 26px;
    font-weight: 700;
    color: var(--accent);
    font-variant-numeric: tabular-nums;
  }
  body.compact .tz-time { font-size: 20px; }

  .tz-sub {
    font-size: 13px;
    color: var(--muted);
  }
  body.compact .tz-sub { font-size: 12px; }

  /* Calendar */
  .year-header {
    display:flex; align-items:center; justify-content:space-between;
    margin: 6px 0 14px;
  }
  .year-selector { display:flex; gap:6px; align-items:center; flex-wrap:wrap; }
  .months {
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 12px;
  }
  .month {
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px;
    background: var(--bg);
  }
  body.compact .month { padding:8px; }
  .month h3 { margin: 0 0 8px; color: var(--accent); font-size:15px; }

  table {
    width:100%;
    border-collapse:collapse;
    font-size:12px;
  }
  th, td {
    border:1px solid var(--border);
    text-align:center;
    padding:6px 4px;
  }
  .week-col { width:2.4rem; color:var(--muted); font-weight:600; background:#f2f3f5; }
  .weekend { background: var(--weekend); }
  .empty { background:#fafbfc; color:transparent; }
  .today { background: var(--highlight); font-weight:700; border:2px solid var(--accent); }

  /* Agriculture table */
  .agri-table th, .agri-table td { font-size:12px; padding:8px; }
  .ag-section-title { font-weight:700; display:block; margin-bottom:4px; }
  .current-quarter { background-color: var(--quarter-highlight); font-weight:700; }

  /* Small helpers */
  .muted { color: var(--muted); font-size:13px; }
  .spacer { flex:1; }

  /* Responsive fixes */
  @media (max-width:560px){
    body { margin:10px; }
    .tz-time { font-size:20px; }
    .tz-item { min-height:70px; }
  }

</style>
</head>
<body>
  <!-- =======================================================
       TOP BAR: Title + global toggles
       ======================================================= -->
  <div class="controls">
    <div class="group">
      <h1 style="margin:0;">World Time & Calendar</h1>
      <div style="margin-left:8px;" class="muted">2024â€“2027</div>
    </div>

    <div class="spacer" aria-hidden="true"></div>

    <!-- Theme toggle -->
    <div class="group" title="Toggle dark / light">
      <button id="themeToggle" class="btn" aria-pressed="false">Dark Mode</button>
    </div>

    <!-- Compact view toggle -->
    <div class="group" title="Compact / Full view">
      <button id="compactToggle" class="btn" aria-pressed="false">Compact View</button>
    </div>

    <!-- Time format toggle -->
    <div class="group" title="Switch 24h / AM-PM">
      <button id="hourToggle" class="btn" aria-pressed="false">24h</button>
    </div>
  </div>

  <!-- =======================================================
       TIMEZONE SECTION
       - displays time + date per configured timezone
       - flags shown as emoji
       - sorted from most advanced -> earliest (latest -> earliest)
       ======================================================= -->
  <section class="card" aria-labelledby="tz-heading">
    <h2 id="tz-heading">Current Local Times</h2>

    <!-- controls for timezones -->
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap;">
      <div class="muted">Display:</div>
      <div>
        <label class="muted" style="margin-right:6px;">Year:</label>
        <div id="yearButtons" style="display:inline-flex;gap:6px;"></div>
      </div>
      <div class="spacer" aria-hidden="true"></div>
      <div class="muted">Tip: times auto-refresh every second</div>
    </div>

    <p class="legend">Timezones shown with flag â€¢ Sorted from most advanced (later local time) â†’ earliest â€¢ Local date included</p>

    <div id="timezones" class="tz-grid" aria-live="polite" aria-relevant="additions"></div>
  </section>

  <!-- =======================================================
       CALENDAR SECTION (2024-2027)
       ======================================================= -->
  <section class="card" style="margin-top:14px;">
    <div class="year-header">
      <h2>Calendar</h2>
      <div class="year-selector" id="yearSelector">
        <!-- buttons created by JS -->
      </div>
    </div>
    <div class="legend">Weekends shaded â€¢ ISO Week Numbers â€¢ Current day highlighted</div>
    <div id="calendar" class="months" aria-live="polite"></div>
  </section>

  <!-- =======================================================
       AGRICULTURAL SEASONS
       ======================================================= -->
  <section class="card" style="margin-top:14px;">
    <h2>Agricultural Seasons & Activities by Region</h2>
    <table class="agri-table" role="table" aria-label="Agricultural seasons">
      <thead>
        <tr>
          <th>Quarter</th>
          <th>North America</th>
          <th>Europe</th>
          <th>Latin America</th>
          <th>APAC</th>
        </tr>
      </thead>
      <tbody>
        <!-- Q1 -->
        <tr>
          <td><strong>Q1<br>(Janâ€“Mar)</strong><br>Winter (NA/EU)<br>Summer (LATAM/APAC)</td>
          <td>
            <span class="ag-section-title">Growing:</span> Wheat, Small Grains
            <span class="ag-section-title">Dormant:</span> Corn, Soybeans
            <span class="ag-section-title">Activities:</span> Equipment Maintenance
          </td>
          <td>
            <span class="ag-section-title">Growing:</span> Wheat, Barley
            <span class="ag-section-title">Activities:</span> Greenhouse Preparation, Limited Spraying
          </td>
          <td>
            <span class="ag-section-title">Harvest:</span> Soybeans, Corn, Sugarcane
            <span class="ag-section-title">Activities:</span> Pest Control Spraying
          </td>
          <td>
            <span class="ag-section-title">Harvest:</span> Rice, Corn, Sugarcane
            <span class="ag-section-title">Activities:</span> Pest Control Spraying
          </td>
        </tr>

        <!-- Q2 -->
        <tr>
          <td><strong>Q2<br>(Aprâ€“Jun)</strong><br>Spring (NA/EU)<br>Autumn (LATAM/APAC)</td>
          <td>
            <span class="ag-section-title">Planting:</span> Corn, Soybeans, Sunflowers
            <span class="ag-section-title">Growing:</span> Wheat (Heading)
            <span class="ag-section-title">Activities:</span> Weed Control Spraying
          </td>
          <td>
            <span class="ag-section-title">Planting:</span> Cereals, Corn, Sunflowers
            <span class="ag-section-title">Activities:</span> Fertilization, Weed Spraying
          </td>
          <td>
            <span class="ag-section-title">Harvest:</span> Corn, Soybeans
            <span class="ag-section-title">Planting:</span> Sugarcane
            <span class="ag-section-title">Activities:</span> Disease Spraying
          </td>
          <td>
            <span class="ag-section-title">Harvest:</span> Rice, Corn
            <span class="ag-section-title">Planting:</span> Sugarcane
            <span class="ag-section-title">Activities:</span> Pest Spraying
          </td>
        </tr>

        <!-- Q3 -->
        <tr>
          <td><strong>Q3<br>(Julâ€“Sep)</strong><br>Summer (NA/EU)<br>Winter (LATAM/APAC)</td>
          <td>
            <span class="ag-section-title">Growing:</span> Corn, Soybeans, Sunflowers (Bloom)
            <span class="ag-section-title">Activities:</span> Pest Spraying
          </td>
          <td>
            <span class="ag-section-title">Growing:</span> Corn, Wheat, Sunflowers
            <span class="ag-section-title">Activities:</span> Irrigation
          </td>
          <td>
            <span class="ag-section-title">Harvest:</span> Sugarcane
            <span class="ag-section-title">Activities:</span> Maintenance, Limited Spraying
          </td>
          <td>
            <span class="ag-section-title">Harvest:</span> Sugarcane
            <span class="ag-section-title">Activities:</span> Maintenance, Limited Spraying
          </td>
        </tr>

        <!-- Q4 -->
        <tr class="current-quarter">
          <td><strong>Q4<br>(Octâ€“Dec)</strong><br>Autumn (NA/EU)<br>Spring (LATAM/APAC)</td>
          <td>
            <span class="ag-section-title">Harvest:</span> Corn, Soybeans, Sunflowers
            <span class="ag-section-title">Planting:</span> Wheat
            <span class="ag-section-title">Activities:</span> Cover Crops
          </td>
          <td>
            <span class="ag-section-title">Harvest:</span> Cereals, Sunflowers
            <span class="ag-section-title">Planting:</span> Wheat
            <span class="ag-section-title">Activities:</span> Soil Preparation
          </td>
          <td>
            <span class="ag-section-title">Planting:</span> Soybeans, Corn, Sunflowers
            <span class="ag-section-title">Growing:</span> Sugarcane (Early)
            <span class="ag-section-title">Activities:</span> Weed Control Spraying
          </td>
          <td>
            <span class="ag-section-title">Planting:</span> Rice, Corn
            <span class="ag-section-title">Growing:</span> Sugarcane (Early)
            <span class="ag-section-title">Activities:</span> Weed Control Spraying
          </td>
        </tr>

      </tbody>
    </table>
  </section>

  <!-- =======================================================
       JAVASCRIPT
       - full of comments (explain what/why)
       ======================================================= -->
<script>
/* --------------------------
   Configuration (edit here)
   -------------------------- */
const CONFIG = {
  // Keep only the locations already present in your HTML (as requested).
  timezones: [
    { name: "Canberra", tz: "Australia/Sydney", flag: "ðŸ‡¦ðŸ‡º" },
    { name: "Pune",                     tz: "Asia/Kolkata",       flag: "ðŸ‡®ðŸ‡³" },
    { name: "Zedelgem",               tz: "Europe/Brussels",    flag: "ðŸ‡§ðŸ‡ª" },
    { name: "Curitiba",                tz: "America/Sao_Paulo",  flag: "ðŸ‡§ðŸ‡·" },
    { name: "New Holland, PA",            tz: "America/New_York",   flag: "ðŸ‡ºðŸ‡¸" },
    { name: "Oak Brook, IL",              tz: "America/Chicago",    flag: "ðŸ‡ºðŸ‡¸" }
  ],
  years: [2024, 2025, 2026, 2027]
};

/* --------------------------
   Persistence keys (localStorage)
   -------------------------- */
const STORAGE_KEYS = {
  dark: "wtc_dark",
  compact: "wtc_compact",
  hour24: "wtc_hour24",
  year: "wtc_year"
};

/* --------------------------
   Utilities
   -------------------------- */
function $(id){ return document.getElementById(id); }
function formatDateISO(d){
  // produce YYYY-MM-DD in local of date object
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}
/* Get short timezone name like 'GMT+10' or 'AEST' where supported.
   Fallback: empty string.
*/
function tzShortName(date, tz){
  try {
    const s = date.toLocaleTimeString('en-US', { timeZone: tz, timeZoneName: 'short' });
    // Usually returns "10:30:00 GMT+10" or "10:30:00 AEST"
    const tokens = s.split(' ');
    return tokens.length>1 ? tokens[tokens.length-1] : "";
  } catch(e){ return ""; }
}

/* --------------------------
   Timezone rendering
   - sorts from most advanced -> earliest (descending local time)
   -------------------------- */
function updateTimezones(){
  const container = $('timezones');
  container.innerHTML = "";

  const now = new Date();
  const hour24 = localStorage.getItem(STORAGE_KEYS.hour24) !== "false"; // default true

  // Map to local dates for each zone
  const zones = CONFIG.timezones.map(z => {
    // create a Date representing current moment in that timezone by using toLocaleString
    const localDate = new Date(now.toLocaleString('en-US', { timeZone: z.tz }));
    return { ...z, localDate };
  });

  // Sort descending: latest local time first (most advanced timezone)
  zones.sort((a,b) => b.localDate - a.localDate);

  zones.forEach(z => {
    const d = z.localDate;

    // format time according to hour24 preference
    const timeOptions = {
      hour: '2-digit', minute: '2-digit', second: '2-digit',
      hour12: !hour24
    };
    let timeStr = d.toLocaleTimeString('en-US', timeOptions);

    // ensure zero-padded 24h with 24h option: some browsers may vary, but this is robust enough
    if (hour24) {
      const h = String(d.getHours()).padStart(2,'0');
      const min = String(d.getMinutes()).padStart(2,'0');
      const sec = String(d.getSeconds()).padStart(2,'0');
      timeStr = `${h}:${min}:${sec}`;
    }

    // get ISO-style date (YYYY-MM-DD)
    const dateStr = formatDateISO(d);

    // timezone short name (e.g. GMT+10 or AEST) - may vary by browser/OS
    const tzShort = tzShortName(d, z.tz);

    // card HTML
    const div = document.createElement('div');
    div.className = 'tz-item';
    div.innerHTML = `
      <div class="tz-top">
        <div class="tz-flag" aria-hidden="true">${z.flag}</div>
        <div class="tz-name">${z.name}</div>
      </div>
      <div class="tz-time" data-time="${timeStr}">${timeStr}</div>
      <div class="tz-sub">${dateStr} ${tzShort ? "â€¢ " + tzShort : ""}</div>
    `;
    container.appendChild(div);
  });
}

/* --------------------------
   Calendar rendering (months grid)
   - supports years 2024..2027
   - highlights today's date
   -------------------------- */
const MONTH_NAMES = ["January","February","March","April","May","June",
                     "July","August","September","October","November","December"];
const DOW_ABBR = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

function getISOWeek(date){
  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
  const day = d.getUTCDay() || 7;
  d.setUTCDate(d.getUTCDate() + 4 - day);
  const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
  return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
}

function renderMonth(year, month){
  const first = new Date(year, month, 1);
  const firstDow = first.getDay();
  const gridStart = new Date(year, month, 1 - firstDow);

  let html = `<div class="month"><h3>${MONTH_NAMES[month]} ${year}</h3><table>`;
  html += `<tr><th class="week-col">Wk</th>${DOW_ABBR.map(d => `<th>${d}</th>`).join('')}</tr>`;

  const today = new Date();
  for (let w = 0; w < 6; w++){
    const weekStart = new Date(gridStart);
    weekStart.setDate(gridStart.getDate() + w * 7);
    const weekNumber = getISOWeek(new Date(weekStart.getFullYear(), weekStart.getMonth(), weekStart.getDate() + 3));
    html += `<tr><td class="week-col">${weekNumber}</td>`;
    for (let d = 0; d < 7; d++){
      const cellDate = new Date(weekStart);
      cellDate.setDate(weekStart.getDate() + d);
      const inMonth = (cellDate.getMonth() === month);
      const isWeekend = (d === 0 || d === 6);
      const isToday = cellDate.getFullYear() === today.getFullYear() &&
                      cellDate.getMonth() === today.getMonth() &&
                      cellDate.getDate() === today.getDate();
      const cls = [
        isWeekend ? "weekend" : "",
        inMonth ? "" : "empty",
        isToday ? "today" : ""
      ].join(' ').trim();
      html += `<td class="${cls}">${inMonth ? cellDate.getDate() : ""}</td>`;
    }
    html += `</tr>`;
  }
  html += `</table></div>`;
  return html;
}

function renderYear(year){
  const container = $('calendar');
  container.innerHTML = "";
  let html = "";
  for (let m = 0; m < 12; m++) html += renderMonth(year, m);
  container.innerHTML = html;
}

/* --------------------------
   UI: Year buttons (both top and calendar)
   - persists selected year
   -------------------------- */
function createYearButtons(){
  const yearButtons = $('yearButtons');
  const yearSelector = $('yearSelector');
  [yearButtons, yearSelector].forEach(el => el.innerHTML = '');
  const selected = Number(localStorage.getItem(STORAGE_KEYS.year)) || new Date().getFullYear();

  CONFIG.years.forEach(y => {
    // small top buttons
    const btnTop = document.createElement('button');
    btnTop.className = 'btn' + (y === selected ? ' active' : '');
    btnTop.textContent = y;
    btnTop.onclick = () => {
      localStorage.setItem(STORAGE_KEYS.year, String(y));
      updateUIForYear(y);
    };
    yearButtons.appendChild(btnTop);

    // calendar selector (bigger same functionality)
    const btn = document.createElement('button');
    btn.className = 'btn' + (y === selected ? ' active' : '');
    btn.textContent = y;
    btn.onclick = () => {
      localStorage.setItem(STORAGE_KEYS.year, String(y));
      updateUIForYear(y);
    };
    yearSelector.appendChild(btn);
  });
}

function updateUIForYear(year){
  // toggle active class for both button groups
  document.querySelectorAll('#yearButtons .btn, #yearSelector .btn').forEach(b => {
    b.classList.toggle('active', Number(b.textContent) === Number(year));
  });
  renderYear(Number(year));
}

/* --------------------------
   Theme / Compact / Hour toggles
   - stored in localStorage so user preferences persist
   -------------------------- */
function applyStoredPreferences(){
  // Dark
  const dark = localStorage.getItem(STORAGE_KEYS.dark) === "true";
  document.documentElement.classList.toggle('dark', dark);
  $('themeToggle').classList.toggle('active', dark);
  $('themeToggle').setAttribute('aria-pressed', dark ? 'true' : 'false');
  $('themeToggle').textContent = dark ? 'Light Mode' : 'Dark Mode';

  // Compact
  const compact = localStorage.getItem(STORAGE_KEYS.compact) === "true";
  document.body.classList.toggle('compact', compact);
  $('compactToggle').classList.toggle('active', compact);
  $('compactToggle').setAttribute('aria-pressed', compact ? 'true' : 'false');

  // Hour format
  const hour24 = localStorage.getItem(STORAGE_KEYS.hour24);
  const hour24bool = (hour24 === null) ? true : (hour24 === "true");
  $('hourToggle').classList.toggle('active', hour24bool);
  $('hourToggle').setAttribute('aria-pressed', hour24bool ? 'true' : 'false');
  $('hourToggle').textContent = hour24bool ? '24h' : 'AM/PM';
}

/* --------------------------
   Event wiring for toggles
   -------------------------- */
function wireToggles(){
  // Theme toggle
  $('themeToggle').addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem(STORAGE_KEYS.dark, isDark ? "true" : "false");
    applyStoredPreferences();
  });

  // Compact toggle
  $('compactToggle').addEventListener('click', () => {
    const compact = document.body.classList.toggle('compact');
    localStorage.setItem(STORAGE_KEYS.compact, compact ? "true" : "false");
    applyStoredPreferences();
  });

  // Hour format toggle
  $('hourToggle').addEventListener('click', () => {
    const current = localStorage.getItem(STORAGE_KEYS.hour24);
    const newVal = !(current === "true" || current === null); // toggle default true -> false
    localStorage.setItem(STORAGE_KEYS.hour24, String(newVal));
    applyStoredPreferences();
    updateTimezones(); // immediately update display format
  });
}

/* --------------------------
   Live refresh loop
   - updateTimezones every 1s, and ensure calendar remains static until year change
   -------------------------- */
let tzInterval = null;
function startLiveUpdates(){
  if (tzInterval) clearInterval(tzInterval);
  updateTimezones();
  tzInterval = setInterval(updateTimezones, 1000);
}

/* --------------------------
   Init on DOMContentLoaded
   - Setup UI, preferences, and start loops
   -------------------------- */
window.addEventListener('DOMContentLoaded', () => {
  // Prepare year buttons & calendar initial view
  createYearButtons();
  const initialYear = Number(localStorage.getItem(STORAGE_KEYS.year)) || new Date().getFullYear();
  updateUIForYear(initialYear);

  // Apply saved preferences (theme / compact / hour)
  applyStoredPreferences();

  // Wire UI toggles
  wireToggles();

  // Start timezone live updates
  startLiveUpdates();
});
</script>

</body>
</html>
